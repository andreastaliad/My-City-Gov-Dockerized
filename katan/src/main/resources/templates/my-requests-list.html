<div th:fragment="content">
    <h4>Τα αιτήματά μου</h4>

    <div class="mb-3">
        <button class="btn btn-primary" onclick="loadContent('/requests/form', 'requests')">
            Δημιουργία νέου αιτήματος
        </button>
    </div>

    <div th:if="${#lists.isEmpty(requests)}">
        <p>Δεν έχετε καταχωρήσει ακόμα αιτήματα.</p>
    </div>

    <div th:if="${!#lists.isEmpty(requests)}">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>Τίτλος</th>
                <th>Περιγραφή</th>
                <th>Συνημμένα</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <th:block th:each="request : ${requests}">
                <tr>
                    <td colspan="4">
                        <div class="border rounded p-3 bg-light text-start">
                            <p class="mb-1"><strong>Τίτλος:</strong> <span th:text="${request.title}"></span></p>
                            <p class="mb-2"><strong>Περιγραφή:</strong> <span th:text="${request.description}"></span></p>

                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <div>
                                    <span th:if="${request.attachmentKey == null || #strings.isEmpty(request.attachmentKey)}">
                                        Δεν υπάρχουν συνημμένα.
                                    </span>
                                    <span th:if="${request.attachmentKey != null && !#strings.isEmpty(request.attachmentKey)}">
                                        <span th:text="${#lists.size(#strings.listSplit(request.attachmentKey, ','))}"></span>
                                        αρχείο(α)
                                    </span>
                                </div>
                                <button class="btn btn-link p-0" type="button" data-toggle-details="true"
                                        th:onclick="|toggleRowDetails('req-details-' + ${request.id}, this)|">
                                    more
                                </button>
                            </div>

                            <div th:id="${'req-details-' + request.id}"
                                 style="display:none;" class="mt-3 pt-3 border-top">
                                <h6 class="mb-2">Συνημμένα αρχεία</h6>
                                <div th:if="${request.attachmentKey == null || #strings.isEmpty(request.attachmentKey)}">
                                    <p class="mb-0">Δεν υπάρχουν συνημμένα.</p>
                                </div>
                                <ul class="mb-0" th:if="${request.attachmentKey != null && !#strings.isEmpty(request.attachmentKey)}">
                                    <li th:each="key, iter : ${#strings.listSplit(request.attachmentKey, ',')}">
                                        <a th:href="@{|/my/requests/${request.id}/attachments/${iter.index}|}"
                                           th:text="${key.substring(key.lastIndexOf('-') + 1)}"></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </td>
                </tr>
            </th:block>
            </tbody>
        </table>
    </div>
</div>
