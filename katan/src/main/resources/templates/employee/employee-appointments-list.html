<div th:fragment="content" id="employeeAppointmentsContent">
    <h4>Ραντεβού Υπηρεσίας</h4>

    <div th:if="${error != null}" class="alert alert-warning" th:text="${error}"></div>
    <div th:if="${success != null}" class="alert alert-success" th:text="${success}"></div>

    <div th:if="${#lists.isEmpty(appointments)}">
        <p>Δεν υπάρχουν ραντεβού.</p>
    </div>

    <table th:if="${!#lists.isEmpty(appointments)}" class="table table-striped align-middle">
        <thead>
        <tr>
            <th>Ημερομηνία</th>
            <th>Ώρα</th>
            <th>Υπηρεσία</th>
            <th>Πολίτης</th>
            <th>Κατάσταση</th>
            <th>Ενέργειες</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="a : ${appointments}">
            <td th:text="${a.date}"></td>
            <td th:text="${a.time}"></td>
            <td th:text="${a.service}"></td>
            <td th:text="${a.personId}"></td>

            <td>
                <span class="badge bg-secondary" th:text="${a.status}"></span>
            </td>

            <td class="d-flex flex-wrap gap-2">

                <!-- Επιβεβαίωση: όταν είναι SCHEDULED ή όταν δεν υπάρχει status (legacy δεδομένα) -->
                <form th:if="${a.status == null
              or a.status == T(gr.hua.dit.my.city.gov.core.model.AppointmentStatus).SCHEDULED}"
                      th:action="@{/employee/appointments/{id}/confirm(id=${a.id})}"
                      method="post"
                      onsubmit="event.preventDefault(); postFormAndReloadEmployeeAppointments(this);">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" class="btn btn-sm btn-success">Επιβεβαίωση</button>
                </form>

                <!-- Αλλαγή ώρας/ημερομηνίας: όταν δεν είναι CANCELLED/COMPLETED/NO_SHOW -->
                <form th:if="${a.status != T(gr.hua.dit.my.city.gov.core.model.AppointmentStatus).CANCELLED
                              and a.status != T(gr.hua.dit.my.city.gov.core.model.AppointmentStatus).COMPLETED
                              and a.status != T(gr.hua.dit.my.city.gov.core.model.AppointmentStatus).NO_SHOW}"
                      th:action="@{/employee/appointments/{id}/reschedule(id=${a.id})}"
                      method="post"
                      class="d-flex gap-2 align-items-center"
                      onsubmit="event.preventDefault(); postFormAndReloadEmployeeAppointments(this);">

                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

                    <!-- Date dropdown -->
                    <select name="newDate"
                            class="form-select form-select-sm js-emp-date"
                            th:attr="data-appointment-id=${a.id},
                                     data-service-unit-id=${a.serviceUnitId},
                                     data-current-date=${a.date}">
                        <!-- Αρχική τιμή: η τρέχουσα -->
                        <option th:value="${a.date}" th:text="${a.date}" selected></option>
                    </select>

                    <!-- Time dropdown -->
                    <select name="newTime"
                            class="form-select form-select-sm js-emp-time"
                            th:attr="data-appointment-id=${a.id},
                                     data-service-unit-id=${a.serviceUnitId},
                                     data-current-time=${a.time}">
                        <!-- Αρχική τιμή: η τρέχουσα -->
                        <option th:value="${a.time}" th:text="${a.time}" selected></option>
                    </select>
                    <button type="submit" class="btn btn-sm btn-primary">Αλλαγή</button>
                </form>

                <!-- Ακύρωση: όταν δεν είναι ήδη CANCELLED/COMPLETED -->
                <form th:if="${a.status != T(gr.hua.dit.my.city.gov.core.model.AppointmentStatus).CANCELLED
                              and a.status != T(gr.hua.dit.my.city.gov.core.model.AppointmentStatus).COMPLETED}"
                      th:action="@{/employee/appointments/{id}/cancel(id=${a.id})}"
                      method="post"
                      class="d-flex gap-2 align-items-center"
                      onsubmit="event.preventDefault(); postFormAndReloadEmployeeAppointments(this);">

                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

                    <input type="text"
                           name="reason"
                           class="form-control form-control-sm"
                           style="width: 220px;"
                           placeholder="Αιτιολογία (προαιρετικό)">

                    <button type="submit" class="btn btn-sm btn-danger">Ακύρωση</button>
                </form>

            </td>
        </tr>
        </tbody>
    </table>
</div>
