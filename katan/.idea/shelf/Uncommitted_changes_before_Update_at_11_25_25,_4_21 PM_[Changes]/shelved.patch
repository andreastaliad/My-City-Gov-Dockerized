Index: src/main/java/gr/hua/dit/my/city/gov/core/service/impl/PersonServiceImpl.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package gr.hua.dit.my.city.gov.core.service.impl;\n\n\n\nimport gr.hua.dit.my.city.gov.core.model.PersonType;\nimport gr.hua.dit.my.city.gov.core.port.LookupPort;\nimport gr.hua.dit.my.city.gov.core.port.PhoneNumberPort;\nimport gr.hua.dit.my.city.gov.core.port.SmsNotificationPort;\nimport gr.hua.dit.my.city.gov.core.repository.PersonRepository;\nimport gr.hua.dit.my.city.gov.core.service.PersonService;\n\nimport gr.hua.dit.my.city.gov.core.service.mapper.PersonMapper;\n\nimport gr.hua.dit.my.city.gov.core.service.model.CreatePersonRequest;\nimport gr.hua.dit.my.city.gov.core.service.model.CreatePersonResult;\n\nimport gr.hua.dit.my.city.gov.core.service.model.PersonView;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.stereotype.Service;\n\n/**\n * Default implementation of {@link PersonService}.\n */\n@Service\npublic class PersonServiceImpl implements PersonService {\n\n    private static final Logger LOGGER = LoggerFactory.getLogger(PersonServiceImpl.class);\n\n    private final PasswordEncoder passwordEncoder;\n    private final PersonRepository personRepository;\n    private final PersonMapper personMapper;\n    private final PhoneNumberPort phoneNumberPort;\n    private final LookupPort lookupPort;\n    private final SmsNotificationPort smsNotificationPort;\n\n    public PersonServiceImpl(final PasswordEncoder passwordEncoder,\n                             final PersonRepository personRepository,\n                             final PersonMapper personMapper,\n                             final PhoneNumberPort phoneNumberPort,\n                             final LookupPort lookupPort,\n                             final SmsNotificationPort smsNotificationPort) {\n        if (passwordEncoder == null) throw new NullPointerException();\n        if (personRepository == null) throw new NullPointerException();\n        if (personMapper == null) throw new NullPointerException();\n        if (phoneNumberPort == null) throw new NullPointerException();\n        if (lookupPort == null) throw new NullPointerException();\n        if (smsNotificationPort == null) throw new NullPointerException();\n\n        this.passwordEncoder = passwordEncoder;\n        this.personRepository = personRepository;\n        this.personMapper = personMapper;\n        this.phoneNumberPort = phoneNumberPort;\n        this.lookupPort = lookupPort;\n        this.smsNotificationPort = smsNotificationPort;\n    }\n\n    @Override\n    public CreatePersonResult createPerson(final CreatePersonRequest createPersonRequest, final boolean notify) {\n        if (createPersonRequest == null) throw new NullPointerException();\n\n        // Unpack (we assume valid `CreatePersonRequest` instance)\n        // --------------------------------------------------\n\n        final PersonType type = createPersonRequest.type();\n        final String huaId = createPersonRequest.huaId().strip(); // remove whitespaces\n        final String firstName = createPersonRequest.firstName().strip();\n        final String lastName = createPersonRequest.lastName().strip();\n        final String emailAddress = createPersonRequest.emailAddress().strip();\n        String mobilePhoneNumber = createPersonRequest.mobilePhoneNumber().strip();\n        final String rawPassword = createPersonRequest.rawPassword();\n\n        // Basic email address validation.\n        // --------------------------------------------------\n\n        if (!emailAddress.endsWith(\"@hua.gr\")) {\n            return CreatePersonResult.fail(\"Only academic email addresses (@hua.gr) are allowed\");\n        }\n\n        // Advanced mobile phone number validation.\n        // --------------------------------------------------\n\n        final PhoneNumberValidationResult phoneNumberValidationResult\n            = this.phoneNumberPort.validate(mobilePhoneNumber);\n        if (!phoneNumberValidationResult.isValidMobile()) {\n            return CreatePersonResult.fail(\"Mobile Phone Number is not valid\");\n        }\n        mobilePhoneNumber = phoneNumberValidationResult.e164();\n\n        // --------------------------------------------------\n\n        if (this.personRepository.existsByHuaIdIgnoreCase(huaId)) {\n            return CreatePersonResult.fail(\"HUA ID already registered\");\n        }\n\n        if (this.personRepository.existsByEmailAddressIgnoreCase(emailAddress)) {\n            return CreatePersonResult.fail(\"Email Address already registered\");\n        }\n\n        if (this.personRepository.existsByMobilePhoneNumber(mobilePhoneNumber)) {\n            return CreatePersonResult.fail(\"Mobile Phone Number already registered\");\n        }\n\n        // --------------------------------------------------\n\n        final PersonType personType_lookup = this.lookupPort.lookup(huaId).orElse(null);\n        if (personType_lookup == null) {\n            return CreatePersonResult.fail(\"Invalid HUA ID\");\n        }\n        if (personType_lookup != type) {\n            return CreatePersonResult.fail(\"The provided person type does not match the actual one\");\n        }\n\n        // --------------------------------------------------\n\n        final String hashedPassword = this.passwordEncoder.encode(rawPassword);\n\n        // Instantiate person.\n        // --------------------------------------------------\n\n        Person person = new Person();\n        person.setId(null); // auto generated\n        person.setHuaId(huaId);\n        person.setType(type);\n        person.setFirstName(firstName);\n        person.setLastName(lastName);\n        person.setEmailAddress(emailAddress);\n        person.setMobilePhoneNumber(mobilePhoneNumber);\n        person.setPasswordHash(hashedPassword);\n        person.setCreatedAt(null); // auto generated.\n\n        // Persist person (save/insert to database)\n        // --------------------------------------------------\n\n        person = this.personRepository.save(person);\n\n        // --------------------------------------------------\n\n        if (notify) {\n            final String content = String.format(\n                \"You have successfully registered for the Office Hours application. \" +\n                    \"Use your email (%s) to log in.\", emailAddress);\n            final boolean sent = this.smsNotificationPort.sendSms(mobilePhoneNumber, content);\n            if (!sent) {\n                LOGGER.warn(\"SMS send to {} failed!\", mobilePhoneNumber);\n            }\n        }\n\n        // Map `Person` to `PersonView`.\n        // --------------------------------------------------\n\n        final PersonView personView = this.personMapper.convertPersonToPersonView(person);\n\n        // --------------------------------------------------\n\n        return CreatePersonResult.success(personView);\n    }\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/gr/hua/dit/my/city/gov/core/service/impl/PersonServiceImpl.java b/src/main/java/gr/hua/dit/my/city/gov/core/service/impl/PersonServiceImpl.java
--- a/src/main/java/gr/hua/dit/my/city/gov/core/service/impl/PersonServiceImpl.java	(revision 5c60aa0117cccf57152fa28217c73da76186fc09)
+++ b/src/main/java/gr/hua/dit/my/city/gov/core/service/impl/PersonServiceImpl.java	(date 1763985051130)
@@ -2,6 +2,7 @@
 
 
 
+import gr.hua.dit.my.city.gov.core.model.Person;
 import gr.hua.dit.my.city.gov.core.model.PersonType;
 import gr.hua.dit.my.city.gov.core.port.LookupPort;
 import gr.hua.dit.my.city.gov.core.port.PhoneNumberPort;
@@ -127,7 +128,7 @@
         person.setFirstName(firstName);
         person.setLastName(lastName);
         person.setEmailAddress(emailAddress);
-        person.setMobilePhoneNumber(mobilePhoneNumber);
+        person.setPhoneNumber(mobilePhoneNumber);
         person.setPasswordHash(hashedPassword);
         person.setCreatedAt(null); // auto generated.
 
Index: src/main/java/gr/hua/dit/my/city/gov/core/model/PersonView.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package gr.hua.dit.my.city.gov.core.model;\n\n/**\n * PersonView (DTO) that includes only information to be exposed.\n */\npublic record PersonView(\n    long id,\n    String huaId,\n    String firstName,\n    String lastName,\n    String mobilePhoneNumber,\n    String emailAddress,\n    PersonType type\n) {}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/gr/hua/dit/my/city/gov/core/model/PersonView.java b/src/main/java/gr/hua/dit/my/city/gov/core/model/PersonView.java
--- a/src/main/java/gr/hua/dit/my/city/gov/core/model/PersonView.java	(revision 5c60aa0117cccf57152fa28217c73da76186fc09)
+++ b/src/main/java/gr/hua/dit/my/city/gov/core/model/PersonView.java	(date 1763985512079)
@@ -12,3 +12,4 @@
     String emailAddress,
     PersonType type
 ) {}
+
